# Apache Configuration for Django Application
# Running on non-privileged port 8080

# Listen on port 8080 (non-root user compatible)
Listen 8080

# Server settings
ServerName localhost
ServerAdmin admin@localhost

# Log settings
ErrorLog /var/log/httpd/error.log
CustomLog /var/log/httpd/access.log combined
LogLevel info

# WSGI configuration
WSGIScriptAlias / /app/server/django_project/wsgi.py
WSGIPythonHome /opt/app-root
WSGIPythonPath /app/server

# WSGI Daemon Process
WSGIDaemonProcess django python-home=/opt/app-root python-path=/app/server
WSGIProcessGroup django

# Main virtual host
<VirtualHost *:8080>
    DocumentRoot /app

    # WSGI settings
    <Directory /app/server/django_project>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    # Static files - served by Apache
    Alias /assets/ /app/staticfiles/
    <Directory /app/staticfiles>
        Require all granted
        Options -Indexes
        AllowOverride None
    </Directory>

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Browser caching for static assets
    <LocationMatch "^/assets/">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </LocationMatch>

    # Error logging
    ErrorLog /var/log/httpd/django-error.log
    CustomLog /var/log/httpd/django-access.log combined
</VirtualHost>

# Disable server signature for security
ServerSignature Off
ServerTokens Prod
